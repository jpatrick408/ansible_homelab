- ansible.builtin.include_vars: "{{ ansible_os_family }}.yml"

- name: Enabling Contrib (Based)
  ansible.builtin.lineinfile:
    path: /etc/apt/sources.list
    backup: true
    search_string: deb http://deb.debian.org/debian/ bookworm main non-free
    line: deb http://deb.debian.org/debian/ bookworm main contrib non-free
    owner: root
    group: root
    mode: '0644'
  when: ansible_distribution == "Debian"

- name: Update all packages (Debian based)
  tags: always
  ansible.builtin.apt:
    upgrade: dist
    update_cache: yes
  when: ansible_os_family == "Debian"

- name: Setting up RPM Fusion
  ansible.builtin.command:
    argv:
      - /usr/bin/dnf
      - install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm
  when: ansible_os_family == "RedHat"

- name: Setting up RPM Fusion
  ansible.builtin.command:
    argv:
      - /usr/bin/dnf
      - config-manager setopt fedora-cisco-openh264.enabled=1
  when: ansible_os_family == "RedHat"

- name: Setting up RPM Fusion
  ansible.builtin.command:
    argv:
      - /usr/bin/dnf
      - install rpmfusion-\*-appstream-data
  when: ansible_os_family == "RedHat"

- name: Update all packages (Fedora based)
  tags: always
  ansible.builtin.dnf:
    name: "*"
    update_cache: yes
    update_only: yes
    state: latest
  when: ansible_os_family == "RedHat"

- name: Copying Bash File
  ansible.builtin.copy:
    src: ../files/bashrc
    dest: /home/{{ invoking_user }}/.bashrc
    mode: "0660"
    owner: "{{ invoking_user }}"
    group: "{{ invoking_user }}"

- name: Creating Mount Folder (jsproart)
  ansible.builtin.file:
    path: /mnt/NVME2
    state: directory
    owner: jpatr
    group: jpatr
    state: directory
  when: ansible_hostname == 'jsproart'

#- name: Mounting Second Drive (jsproart)
#  ansible.posix.mount:
#    src: /dev/nvme0n1p1
#    path: /mnt/NVME2
#    opts: 'defaults,x-gvfs-show 0 0'
#    fstype: btrfs
#    state: mounted
#  when: ansible_hostname == 'jsproart'

- block:
  - ansible.builtin.import_tasks: subtasks/001_microcode.yml
  - ansible.builtin.import_tasks: subtasks/002_commonApps.yml
  - ansible.builtin.import_tasks: subtasks/003_autoRemove.yml
